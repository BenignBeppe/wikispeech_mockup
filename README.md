# Server for wikispeech tts.


## Install:
```
sudo python3 setup.py install
```

or, without sudo, for example

```
mkdir ~/python3
export PYTHONPATH=~/python3/lib/python
export PATH=$PATH:~/python3/bin
python3 setup.py install --home=~/python3/
```


## Usage:
```
wikispeech
```
or
```
python3 wikispeech_mockup/wikispeech.py
```



## Configuration:

For local configuration, make a copy of wikispeech_mockup/user-host_example.conf,
name it <username>-<hostname>.conf, and edit it as needed.

The usage examples will both test that the configuration is correct, and that a lexicon server and a marytts server are accessible.

Test:
```
python3 test/test_api.py
```
(tests that the api calls return what is expected)

```
python3 test/test_voice_configs.py
```
(tests voice/server configurations)

```
google-chrome test.html
```
(may not work to load the audio, depends on setup)

```
google-chrome http://localhost:10000/wikispeech/?lang=sv&input=Ett+test
```

## Documentation:

started in https://github.com/stts-se/wikispeech_mockup/wiki


## Apache setup:

#### 1. (required)
Link the audio file directory in <webroot>, as defined in default.conf or your local configuration file:
```
$ cd <webroot>; sudo ln -s <audio_tmpdir> <audio_prefix>
```

example:
```
$ cd /var/www/html; sudo ln -s ~/git/wikispeech_mockup/wikispeech_mockup/tmp/ audio
```

Audio files generated by the TTS should now be accessible through: http://localhost/audio/ and from outside at http://<HOSTNAME>/audio



#### 2. (optional - to avoid unwanted access)

Disallow access to non-opus files by adding a .htaccess-file in ~/wikispeech_mockup/tmp/ with the following content

```
<FilesMatch "\.*$">
  Deny from all
</FilesMatch>
<FilesMatch "\.opus$">
  Order deny,allow
  Allow from all
</FilesMatch>
```

Remove directory listing by adding a index.html file in ~/wikispeech_mockup/tmp/ with something like the following content:

This is a service to serve Wikispeech audio files. There is really never any reason to see this page.

To also display this page in the root directory (instead of apache default): $ cd /var/www/html/; sudo rm index.html; sudo ln -s audio/index.html

#### 3. (optional - for access through apache)


To access the wikispeech server through apache:
Add something like this to your apache config file (for example "/etc/apache2/sites-enabled/000-default.conf") and restart
apache (for example with "sudo apache2ctl restart")

```
ProxyPreserveHost On
ProxyPass         /wikispeech/  http://127.0.0.1:10000/wikispeech/
ProxyPassReverse  /wikispeech/  http://127.0.0.1:10000/wikispeech/
ProxyRequests     Off
```

#### 4. (optional - for testing through apache)

Link this directory in apache's document root, for example: 
```
cd /var/www/html; sudo ln -s ~/git/wikispeech_mockup
```

Test:
```
google-chrome http://localhost/wikispeech_mockup/test.html
```
